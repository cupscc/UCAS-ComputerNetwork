# 第三次作业

2019K8009907018 王畅路

1.使用 TCP 对实时通话数据的传输会有什么问题？使用 UDP 在传送数据文件时会有什么问题？

TCP的延迟会比较大，因为TCP有拥塞控制机制

UDP可能会出现丢包现象，并且UDP不会检测包是否丢失，只提供尽最大努力的交付，可能导致文件丢失


2.如下为 UDP 数据报首部格式。假设一个 UDP 用户数据报的首部的十六进制为 06 32 00 45 00 1C E2 17，请回答一下问题：

（1）请问源端口、目的端口、用户数据报的总长度、数据部分长度；

源端口：1586

目的端口：105

数据包总长度：34

数据部分长度：34-8=26

（2）这个用户数据报是从客户发送给服务器还是从服务器发送给客户？

因为源端口不为0，因此是从客户发给服务器的。

3.试用具体例子说明为什么 TCP 在进行连接建立时要采用“三次握手”，若客户端不向服务器端应答“三次握手”中的最后一个确认报文段，可能出现什么问题？

假设A，B两个节点建立连接。

A发出第一个连接请求未丢失，只是在某些网络结点滞留了，以致延误到连接释放后的某个时间才到达B；B收到这个早已失效的请求后，误以为A发起了一次新的连接请求，向A发送确认报文段，同意建立连接

此种情况，若不采用三次握手，B则单方面建立起了连接，但A并没有建立，因此也不会向B发送数据，B却一直等待，B的资源被浪费

4.主机 A 向主机 B 连续发送了两个 TCP 报文段，其序号分别为 60 和 100。试问：
（1）第一个报文段携带了多少个字节的数据？

100-60 = 40个字节

（2）主机 B 收到第一个报文段后发回的确认中的确认号应当是多少？

100

（3）如果主机 B 收到第二个报文段发回的确认中的确认号是 150，试问 A 发送的第二个报文段中的数据有多少字节？

150-100 = 50

（4）如果 A 发送的第一个报文段丢失了，但第二个报文段到达了 B。B 在第二个报文段到达后向 A 发送确认。试问这个确认号应为多少？

60

（5）针对上述第 4 个问题描述的情况，主机 B 可以采取选择确认的方式，减少重复数据的发送，请描述选择确认机制的基本原理。

TCP收到乱序数据后，会将其放入乱序队列中，然后发送重复ACK给对端。对端如果收到多个重复的ACK，认为发生丢包，TCP会重传最后确认的包开始的后续包。这样原先已经正确传输的包可能会重复发送，降低了TCP性能。为改善这种情况，发展出SACK技术，使用SACK选项可以告知发包方收到了哪些数据，发包方收到这些信息后就会知道哪些数据丢失，然后立即重传丢失的部分。

5.简述什么是流量控制和拥塞控制，TCP/IP 网络是如何解决这两个问题的？

流量控制：是为了防止快发送方给慢接收方发数据造成接收崩溃，缓冲区溢出，从而对发送速率进行控制。通过接收方控制发送窗口大小来对流量进行控制

拥塞控制：多个传输流共享(争用)网络内资源，资源需求超过网络容量时，产生问题。调整拥塞窗口大小

6.自适应重传是实现可靠传输的重要基础，传输控制协议 TCP 中定义了超时重传和快速重传的机制，请分别说明这两种机制的基本原理并分析其特点。


超时重传：TCP 每发送一个报文段，就对这个报文段设置一个定时器，定时器到期，还没有收到确认，就重传该报文段。很难给出任意TCP连接的超时重传时间，设置过长，恢复丢包效率低，设置过短，导致误重传

快速重传：要求接收方不要等待自己发送数据时才进行捎带确认，而是要立即发送ACK，即使收到了乱序的报文段也要立即发出对已收到的报文段的重复确认。重复确认触发重传。

7.（1）长度为 250 字节的应用层数据交给运输层传送，需加上 25 字节的 TCP 首部。再交给网络层传送，需加上 25 字节的 IP 首部。最后交给数据链路层的以太网传送，加上首部和尾部 18 字节。试求数据的传输效率。若应用层数据长度为 1500 字节，数据的传输效率是多少？

250/（250+25+25+18） = 78.6%

不考虑MTU和ip分片 1500/（1500+25+25+18） = 95.7%

（2）长度为 40 字节的应用层数据交给传输层传送，需要加上 25 字节的 TCP 首部。再交给网络层传送，需要加上 25 字节的 IP 首部。最后交给数据链路层的以太网传送，加上首部和尾部共 18 字节。试求数据的传输效率。若应用层数据长度为 400 字节，数据的传输效率是多少？

40/（40+25+25+18） = 37%

400/（400+25+25+18） = 85.5%

（3）一个 TCP 连接总是以 1KB 的最大段发送 TCP 段，发送方有足够多的数据要发送。当拥塞窗口为 16KB 时发生了超时，如果接下来的 4 个 RTT（往返时间）时间内的 TCP 段的传输都是成功的，那么当第 4 个 RTT 时间内发送的所有 TCP 段都得到肯定应答时，拥塞窗口大小是多少？

9KB

8.假设一个 TCP 连接总是以 1KB 的最大段发送 TCP 报文段，且发送方有足够多的数据要发送，接收方有足够的接收能力（接收窗口足够大）。发送方以拥塞窗口为 1KB 开始发送，当拥塞窗口为 32KB 时发生了数据丢失而超时，在这之后的连续的 10 个 RTT（往返时间）时间内的 TCP 报文段的传输都是成功的，接着再往后因为一个 TCP 报文段传输时延过大而导致发送方接收到三个连续的重复确认。
（1）试画出拥塞窗口和传输轮次（1 个 RTT 时间为 1 个轮次，从 1 开始计数）的时间曲线图。

![1655831817639](image/第三次作业/1655831817639.png)

（2）分别指明 TCP 工作在慢启动阶段、拥塞避免阶段的时间段（时间以轮次为单位）。

慢启动：0-4

拥塞避免：4-10，10-19

（3）在第 8 轮次，第 19 轮次发送时，拥塞窗口 cwnd 和门限 ssthresh 分别被设置为多大？

    cwnd    ssthresh

第8轮：20           16

第19轮：19          11

（4）在第几轮次发送出第 50 个报文段？

第六轮

9.域名系统的主要功能是什么？设想有一天整个互联网的 DNS 系统都瘫痪了，试问还有可能给朋友发送电子邮件吗，请说明理由。

域名系统是将域名和IP地址相互映射的一个分布式数据库，主要功能是提供域名解析服务，并将域名解析为IP地址，实现用户访问网站时只用输入域名即可访问的功能，能够使人更方便地访问互联网。

不能发送，DNS是Internet上解决网上机器命名的一种系统Internet上当一台主机要访问另外一台主机时，必须首先获知其地址。

电子邮件服务器与DNS系统是始终分不开的，如果要发电子邮件，就得通过邮件服务器帮将信件送出去。由于IP地址相对难以记忆，因此要有域名与IP地址的对应，这就是DNS系统，因此在收发电子邮件的过程中要用到DNS系统域名解析。

10.DNS 服务（域名解析）、Web 服务、DHCP 服务（动态主机配置）是三种常见的 C/S（客户/服务器）模式的服务。在靠近客户端的一侧，这三种服务中分别定义了本地域名服务器、Web 代理、DHCP 代理等实体角色类型，请简要说明这三种实体的主要功能

本地域名服务器：任何一台主机在网络地址配置时，都会配置一个域名服务器作为默认域名服务器，这个默认域名服务器通常称为本地域名服务器，是主机进行域名查询过程中首先被查询的域名服务器。

Web代理：把最近的一些请求和响应暂存在本地磁盘中，当与暂时存放的请求相同的新请求到达时，万维网高速缓存就把暂存的响应发送出去，而不需要按
URL 的地址再去互联网访问该资源

DHCP代理：每个网络至少有一个DHCP 中继代理，它配置了DHCP 服务器的IP 地址信息，当DHCP 中继代理收到主机发送的发现报文后，就以单播方式向 DHCP 服务器转发此报文，并等待其回答，收到DHCP 服务器的提供报文后，DHCP中继代理再将此报文发回给主机。
